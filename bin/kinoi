#!/usr/bin/env node
const kinoi = require('../')
const path = require('path')
const parse = require('minimist')
const args = parse(process.argv.slice(2), {
  alias: {h: 'host', p: 'port'},
  default: {h: '0.0.0.0', p: process.env.PORT || 3000},
  boolean: ['help']
})

let fn = null
let file = args._.pop()

if (!file) {
  // FIXME: read package.json
  process.exit(1)
}

file = path.resolve(file)

// FIXME
// 0. compile file
// 1. dump
// 2. require

try {
  fn = require(file)
} catch (err) {
  console.error(err.message)
}

kinoi(fn).listen(args.port)
console.log(`> Starting on ${args.port}`)
